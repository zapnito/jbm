require "uri"
require "net/http"

class ChangesController < ApplicationController

  def update

  	case params[:payload][:status]
  	when "success"
  		send_request(body(codes.fetch(:blue)))
  	when "running"
  		send_request(body(codes.fetch(:yellow)))
  	when "failed"
  		send_request(body(codes.fetch(:red)))
  	when "fixed"
		send_request(body(codes.fetch(:green)))
  	end

    render :nothing => true
  end

  private

  def codes
    {
	  	red: "342,172,22,21,22,21,21,21,22,21,22,21,21,21,22,21,22,21,21,65,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,65,21,21,22,21,22,64,22,65,21,21,22,21,22,21,21,21,22,65,21,65,22,21,21,21,22,65,21,65,22,64,22,1532,342,86,22,3690,342,86,22,3690,342,86,22,3692,342,86,22,3690,342,86,22,3690,148,280,18,3694,150,278,17,3695,67,361,4,3791",
	  	blue: "342,172,22,21,22,21,21,21,22,21,22,21,21,21,22,21,22,21,21,65,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,21,22,21,21,65,22,64,22,21,22,21,21,65,22,21,21,65,22,64,22,21,22,21,21,65,22,64,22,21,22,64,22,1534,342,86,22,3695,234,101,4,4,4,86,22,3695,342,86,22,3695,342,86,22,3695,342,86,22,3694,342,86,22,3695,342,86,22,3695,342,86,22,3695,342,86,22,3800",
	  	green: "341,173,21,21,22,21,22,21,21,21,22,21,22,21,21,21,22,21,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,21,22,64,22,65,21,21,22,21,22,21,21,21,22,21,22,64,22,21,22,21,21,65,22,64,22,65,21,1532,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3791",
	  	yellow: "341,173,21,21,22,21,22,21,21,21,22,21,22,21,21,21,22,21,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,65,21,21,22,21,22,64,22,65,21,65,22,21,21,21,22,21,22,64,22,65,21,21,22,21,22,21,21,65,22,64,22,65,21,1532,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3688,341,86,22,3791",
	  	white: "341,173,21,21,22,21,22,21,21,21,22,21,22,21,21,21,22,21,22,64,22,65,21,65,22,64,22,65,21,65,22,64,22,65,21,65,22,21,21,65,22,21,21,65,22,21,21,21,22,21,22,21,21,65,22,21,21,65,22,21,21,65,22,64,22,65,21,1531,341,86,22,3687,341,86,22,3687,341,86,22,3687,341,86,22,3687,298,3791"
    }
  end

  def body(code)
  	"{'frequency':'38000', 'irCode':'#{code}', 'repeat':'1'}"
  end

  def send_request(json_body)
  	uri = URI.parse("http://192.168.1.3/api/v1/irports/1/sendir")
	post_body = []
	post_body << "Content-Type: application/jsonrn"
	post_body << "rn"
	post_body << json_body

	http = Net::HTTP.new(uri.host, uri.port)
	request = Net::HTTP::Post.new(uri.request_uri)
	request.body = post_body.join
	http.request(request)
  end

end

